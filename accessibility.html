<!-- Accessibility enhancements for bead presentation -->
<style>
/* ============================================
   SCREEN READER UTILITIES
   ============================================ */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* ============================================
   SKIP NAVIGATION
   ============================================ */
.skip-link {
  position: absolute;
  left: -999px;
  top: auto;
  z-index: 1000;
  padding: 0.5rem 1rem;
  background: #fff;
  border: 2px solid currentColor;
  text-decoration: none;
  color: #000;
}

.skip-link:focus {
  left: 1rem;
  top: 1rem;
}

.demo-skip-container {
  position: fixed;
  top: 10px;
  right: 10px;
  z-index: 1000;
  background: rgba(255, 255, 255, 0.95);
  padding: 10px;
  border-radius: 5px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  display: none;
  max-width: 200px;
}

.skip-demo-button {
  padding: 8px 16px;
  background: #007bff;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 500;
  width: 100%;
}

.skip-demo-button:hover,
.skip-demo-button:focus {
  background: #0056b3;
  outline: 3px solid #ffa500;
  outline-offset: 2px;
}

/* ============================================
   FOCUS INDICATORS
   ============================================ */
:focus-visible {
  outline: 3px solid currentColor !important;
  outline-offset: 3px !important;
}

.reveal .controls button:focus-visible {
  outline: 3px solid #fff !important;
  outline-offset: 3px !important;
}

.slide-menu-button:focus-visible {
  outline: 3px solid currentColor !important;
}

/* Terminal specific focus */
.terminal:focus {
  outline: 3px solid #0ff;
  outline-offset: 2px;
}

.terminal:focus-visible {
  outline: 3px solid #0ff;
  outline-offset: 2px;
}

.terminal[tabindex="0"] {
  overflow-y: auto;
}

.terminal .command:focus,
.terminal .output:focus {
  outline: 2px dotted #0ff;
  outline-offset: 1px;
}

/* ============================================
   HIGH CONTRAST MODE
   ============================================ */
@media (prefers-contrast: high) {
  .skip-demo-button {
    border: 2px solid currentColor;
  }
  
  .demo-skip-container {
    border: 2px solid currentColor;
  }
  
  .terminal {
    border: 2px solid currentColor;
  }
}

/* ============================================
   REDUCED MOTION
   ============================================ */
@media (prefers-reduced-motion: reduce) {
  * {
    animation: none !important;
    transition: none !important;
    scroll-behavior: auto !important;
  }
  
  .reveal .slides section {
    transition-duration: 0ms !important;
  }
  
  .reveal .slides section .fragment {
    transition: none !important;
  }
  
  .cursor {
    animation: none !important;
  }
  
  .terminal * {
    opacity: 1 !important;
    visibility: visible !important;
  }
}

/* ============================================
   ARIA ENHANCEMENTS
   ============================================ */
.cursor[aria-hidden="true"] {
  speak: none;
}

.terminal .output[role="log"] {
  display: block;
  white-space: pre-wrap;
}

/* Ensure proper reading order */
.reveal .slides {
  role: main;
}
</style>

<script>
// ============================================
// ACCESSIBILITY CONFIGURATION
// ============================================
const A11Y_CONFIG = {
  demoStart: 14,  // Adjust to your actual demo start slide
  demoEnd: 176,   // Adjust to your actual demo end slide
  skipKey: 's',   // Alt+S to skip
  debug: false    // Set to true to see console logs
};

// ============================================
// SKIP NAVIGATION FUNCTIONALITY
// ============================================
function initSkipNavigation() {
  if (typeof Reveal === 'undefined') {
    setTimeout(initSkipNavigation, 100);
    return;
  }
  
  const skipContainer = document.createElement('div');
  skipContainer.className = 'demo-skip-container';
  skipContainer.setAttribute('role', 'navigation');
  skipContainer.setAttribute('aria-label', 'Skip demo navigation');
  
  // Show/hide skip button based on slide
  Reveal.on('slidechanged', function(event) {
    const slideNumber = event.indexh + 1;
    
    if (slideNumber >= A11Y_CONFIG.demoStart && slideNumber <= A11Y_CONFIG.demoEnd) {
      skipContainer.style.display = 'block';
      skipContainer.innerHTML = `
        <button class="skip-demo-button" 
                onclick="Reveal.slide(${A11Y_CONFIG.demoEnd})"
                aria-label="Skip to slide ${A11Y_CONFIG.demoEnd + 1}">
          Skip Demo (Slide ${A11Y_CONFIG.demoEnd + 1})
        </button>
      `;
      if (!skipContainer.parentNode) {
        document.body.appendChild(skipContainer);
      }
    } else {
      skipContainer.style.display = 'none';
    }
  });
  
  // Keyboard shortcut
  document.addEventListener('keydown', function(e) {
    if (e.altKey && e.key === A11Y_CONFIG.skipKey) {
      const currentSlide = Reveal.getIndices().h + 1;
      if (currentSlide >= A11Y_CONFIG.demoStart && currentSlide <= A11Y_CONFIG.demoEnd) {
        Reveal.slide(A11Y_CONFIG.demoEnd);
        announceToScreenReader('Skipped to end of demo section');
      }
    }
  });
  
  if (A11Y_CONFIG.debug) {
    console.log('Skip navigation initialized', A11Y_CONFIG);
  }
}

// ============================================
// SCREEN READER ANNOUNCEMENTS
// ============================================
function announceToScreenReader(message) {
  const announcement = document.createElement('div');
  announcement.setAttribute('role', 'status');
  announcement.setAttribute('aria-live', 'assertive');
  announcement.className = 'sr-only';
  announcement.textContent = message;
  document.body.appendChild(announcement);
  setTimeout(() => announcement.remove(), 1000);
}

// ============================================
// ENHANCED KEYBOARD NAVIGATION
// ============================================
function enhanceKeyboardNav() {
  // Add labels to reveal controls if missing
  const controls = {
    '.navigate-left': 'Previous slide',
    '.navigate-right': 'Next slide',
    '.navigate-up': 'Previous vertical slide',
    '.navigate-down': 'Next vertical slide'
  };
  
  Object.entries(controls).forEach(([selector, label]) => {
    const button = document.querySelector(`.reveal .controls ${selector}`);
    if (button && !button.getAttribute('aria-label')) {
      button.setAttribute('aria-label', label);
    }
  });
  
  // Ensure slide menu button is labeled
  const slideMenuButton = document.querySelector('.slide-menu-button');
  if (slideMenuButton && !slideMenuButton.getAttribute('aria-label')) {
    slideMenuButton.setAttribute('aria-label', 'Open slide navigation menu');
  }
}

// ============================================
// MAIN LANDMARK SETUP
// ============================================
function setupMainLandmark() {
  const slides = document.querySelector('.reveal .slides');
  if (slides && !slides.getAttribute('role')) {
    slides.setAttribute('role', 'main');
    slides.setAttribute('aria-label', 'Presentation slides');
  }
}

// ============================================
// INITIALIZE EVERYTHING
// ============================================
document.addEventListener('DOMContentLoaded', function() {
  setupMainLandmark();
  enhanceKeyboardNav();
  initSkipNavigation();
  
  // Add screen reader instructions
  if (!document.querySelector('.a11y-instructions')) {
    const instructions = document.createElement('div');
    instructions.className = 'sr-only a11y-instructions';
    instructions.setAttribute('role', 'complementary');
    instructions.setAttribute('aria-label', 'Keyboard shortcuts');
    instructions.innerHTML = `
      <h2>Keyboard Navigation</h2>
      <p>Terminal demo spans slides ${A11Y_CONFIG.demoStart} to ${A11Y_CONFIG.demoEnd}.</p>
      <p>Press Alt+${A11Y_CONFIG.skipKey.toUpperCase()} to skip the demo section.</p>
      <p>Use arrow keys to navigate slides. Press Escape for overview.</p>
    `;
    document.body.insertBefore(instructions, document.body.firstChild);
  }
  
  if (A11Y_CONFIG.debug) {
    console.log('Accessibility features initialized');
  }
});

// ============================================
// PUBLIC API (if needed by other scripts)
// ============================================
window.A11Y = {
  config: A11Y_CONFIG,
  announce: announceToScreenReader,
  skipToEnd: function() {
    Reveal.slide(A11Y_CONFIG.demoEnd);
  }
};
</script>